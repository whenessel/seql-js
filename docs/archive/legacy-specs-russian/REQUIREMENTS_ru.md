# DSL Identity ‚Äî Requirements & Context

## –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏

**–î–∞—Ç–∞**: 2025-01-15  
**–ü—Ä–æ–µ–∫—Ç**: DOM Element Identity DSL for rrweb  
**Scope**: Recording & Analytics (Primary)

---

## Executive Summary

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å Domain-Specific Language (DSL) –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ session replay (rrweb).

**–ö–ª—é—á–µ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞**:

```
CSS –∏ XPath ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–±—ã –∏—Å–∫–∞—Ç—å.
DSL ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ.
```

---

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –º–æ—Ç–∏–≤–∞—Ü–∏—è

### 1.1 –ü—Ä–æ–±–ª–µ–º–∞

–í —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ –≤–µ–±-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ session replay (–≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ rrweb) –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —É—Å—Ç–æ–π—á–∏–≤—ã–π, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ DOM-—ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π:

- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–º—ã—Å–ª —ç–ª–µ–º–µ–Ω—Ç–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ layout
- ‚úÖ –ü—Ä–∏–≥–æ–¥–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- ‚úÖ –ù–µ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —Ö—Ä—É–ø–∫–∏–µ CSS/XPath-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã

### 1.2 –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–¥—Ö–æ–¥—ã –∏ –∏—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

| –ü–æ–¥—Ö–æ–¥        | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏                            |
| ------------- | ------------------------------------- |
| CSS —Å–µ–ª–µ–∫—Ç–æ—Ä—ã | –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã  |
| XPath         | –•—Ä—É–ø–∫–∏–µ, –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–æ—Ä—è–¥–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ |
| nth-child     | –õ–æ–º–∞—é—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ siblings      |
| id            | –ß–∞—Å—Ç–æ dynamic/generated, –Ω–µ—É–Ω–∏–∫–∞–ª—å–Ω—ã  |
| class         | Utility-–∫–ª–∞—Å—Å—ã, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã           |

**–°–ª–µ–¥—Å—Ç–≤–∏–µ**: –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–¥—ë–∂–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ DOM-—ç–ª–µ–º–µ–Ω—Ç—ã –≤–æ –≤—Ä–µ–º–µ–Ω–∏.

### 1.3 –¶–µ–ª—å

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å DSL (Domain-Specific Language), –∫–æ—Ç–æ—Ä—ã–π:

1. **–û–ø–∏—Å—ã–≤–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å** DOM-—ç–ª–µ–º–µ–Ω—Ç–∞, –∞ –Ω–µ –ø—É—Ç—å –∫ –Ω–µ–º—É
2. **–ú–æ–∂–µ—Ç –±—ã—Ç—å**:
   - –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏
   - –°–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω –≤–º–µ—Å—Ç–µ —Å DOM-—Å–Ω–∞–ø—à–æ—Ç–æ–º
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
   - –†–µ–∑–æ–ª–≤–ª–µ–Ω –≤ DOM –≤–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

---

## 2. –û–±–ª–∞—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (Scope)

DSL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç—Ä—ë—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö, –Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö:

### 2.1 Recording (rrweb recorder) ‚Äî PRIMARY FOCUS

**–ö–æ–≥–¥–∞**: –í–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–µ—Å—Å–∏–∏

**–ì–¥–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è**: –ü—Ä–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è—Ö:

- `click`
- `input`
- `focus`
- `hover` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:

- ‚ö° –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π runtime overhead
- üéØ –°—Ç—Ä–æ–≥–∞—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
- üîí –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ —Å–æ–±—ã—Ç–∏–π
- üö´ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –º–æ–¥–µ–ª—å —Å–æ–±—ã—Ç–∏–π rrweb

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**:

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DSL: ‚â§ 5ms –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç
- –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: O(depth), –≥–¥–µ depth ‚â§ 10

### 2.2 Analytics (runtime / production) ‚Äî PRIMARY FOCUS

**–ö–æ–≥–¥–∞**: –í –ø—Ä–æ–¥–∞–∫—à–Ω-—Ç—Ä–∞—Ñ–∏–∫–µ, –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–î–ª—è —á–µ–≥–æ**:

- –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –ø–æ "–æ–¥–Ω–æ–º—É –∏ —Ç–æ–º—É –∂–µ —ç–ª–µ–º–µ–Ω—Ç—É"
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É:
  - E2E-—Ç–µ—Å—Ç–∞–º–∏
  - –ü—Ä–æ–¥–∞–∫—à–Ω-—Ç—Ä–∞—Ñ–∏–∫–æ–º
  - –†–∞–∑–Ω—ã–º–∏ —Ä–µ–ª–∏–∑–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:

- üìä –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å DSL –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏: ‚â• 95%
- üîë –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ‚â• 90%
- üì¶ –ö–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç—å: ‚â§ 2KB JSON

### 2.3 Replay (rrweb player) ‚Äî SECONDARY

**–ö–æ–≥–¥–∞**: –í–æ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∞–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏

**–î–ª—è —á–µ–≥–æ**:

- –†–µ–∑–æ–ª–≤ DSL ‚Üí DOM-—ç–ª–µ–º–µ–Ω—Ç –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º DOM
- –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (heatmap)
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω—Å–ø–µ–∫—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:

- üéØ –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–µ–∑–æ–ª–≤–∞: ‚â• 99%
- ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∑–æ–ª–≤–∞: ‚â§ 50ms –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç
- üîÑ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ fallback-–º–µ—Ö–∞–Ω–∏–∑–º–æ–≤

---

## 3. –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (High-level)

### 3.1 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

DSL –æ–±—è–∑–∞–Ω:

| ID   | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ                                                  | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
| ---- | ----------------------------------------------------------- | ----------- |
| FR-1 | –û–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç                     | MUST        |
| FR-2 | –ë—ã—Ç—å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—Ö–æ–¥ ‚Üí –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤—ã—Ö–æ–¥) | MUST        |
| FR-3 | –ë—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí —Ç–æ—Ç –∂–µ DSL)       | MUST        |
| FR-4 | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–µ–∑–æ–ª–≤ –≤ –Ω–∞—Ç–∏–≤–Ω–æ–º DOM                          | MUST        |
| FR-5 | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ä–µ–∑–æ–ª–≤ –≤ rrdom (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π DOM rrweb)          | MUST        |
| FR-6 | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—é –∏ fallback-–º–µ—Ö–∞–Ω–∏–∑–º—ã                | MUST        |
| FR-7 | –ë—ã—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–º (JSON)                                   | MUST        |
| FR-8 | –ë—ã—Ç—å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä—É–µ–º—ã–º                                         | MUST        |
| FR-9 | –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å forward compatibility                          | SHOULD      |

### 3.2 –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

DSL –æ–±—è–∑–∞–Ω:

| ID    | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ                                            | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
| ----- | ----------------------------------------------------- | ----------- |
| NFR-1 | –ë—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç UI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ (React, Vue, etc.) | MUST        |
| NFR-2 | –ù–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç layout-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã                       | MUST        |
| NFR-3 | –ù–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π HTML                           | MUST        |
| NFR-4 | –ù–µ –Ω–∞—Ä—É—à–∞—Ç—å privacy (PII)                             | MUST        |
| NFR-5 | –ò–º–µ—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å O(depth)                | SHOULD      |
| NFR-6 | –ë—ã—Ç—å –∏—Å–ø–æ–ª–Ω–∏–º—ã–º –≤ browser sandbox                     | MUST        |
| NFR-7 | –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å main thread > 16ms                     | SHOULD      |
| NFR-8 | –ó–∞–Ω–∏–º–∞—Ç—å ‚â§ 2KB –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ                 | SHOULD      |

---

## 4. –ú–æ–¥–µ–ª—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏

### 4.1 –ü—Ä–∏–Ω—Ü–∏–ø

```
DSL –æ–ø–∏—Å—ã–≤–∞–µ—Ç ¬´—á—Ç–æ —ç—Ç–æ –∑–∞ —ç–ª–µ–º–µ–Ω—Ç¬ª,
–∞ –Ω–µ ¬´–∫–∞–∫ –¥–æ –Ω–µ–≥–æ –¥–æ–π—Ç–∏¬ª.
```

### 4.2 –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏

–î–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞:

| –ò–∑–º–µ–Ω–µ–Ω–∏–µ                       | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∫ DSL | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| ------------------------------- | ---------------- | --------- |
| –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è             | DSL –∏–¥–µ–Ω—Ç–∏—á–µ–Ω    | MUST      |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ layout (flex ‚Üí grid)  | DSL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è  | MUST      |
| –ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ siblings           | DSL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è  | MUST      |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ wrapper div          | DSL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è  | MUST      |
| Replay DOM (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)     | DSL —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è   | MUST      |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ CSS –∫–ª–∞—Å—Å–æ–≤ (utility) | DSL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è  | SHOULD    |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ inline styles         | DSL –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è  | MUST      |

### 4.3 –ß—Ç–æ –ù–ï —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏

–î–æ–ø—É—Å—Ç–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö DSL **–º–æ–∂–µ—Ç** –∏–∑–º–µ–Ω–∏—Ç—å—Å—è:

- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ (button ‚Üí link)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (Submit ‚Üí Send)
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ ARIA-—Ä–æ–ª–∏ (button ‚Üí menuitem)
- –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –¥—Ä—É–≥—É—é —Å–º—ã—Å–ª–æ–≤—É—é –æ–±–ª–∞—Å—Ç—å (–¥—Ä—É–≥–æ–π anchor)

---

## 5. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ DSL (—è–∑—ã–∫)

### 5.1 –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

DSL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:

- ‚úÖ –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º (–æ–ø–∏—Å—ã–≤–∞–µ—Ç "—á—Ç–æ", –∞ –Ω–µ "–∫–∞–∫")
- ‚úÖ –ú–∞—à–∏–Ω–æ—á–∏—Ç–∞–µ–º—ã–º (JSON)
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º—ã–º (–Ω–æ–≤—ã–µ —Ç–∏–ø—ã —É–∑–ª–æ–≤/constraints)
- ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç CSS –∏ XPath –∫–∞–∫ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–º (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

### 5.2 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DSL (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è)

DSL –æ–±—è–∑–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –û–ø–∏—Å–∞–Ω–∏–µ                                   | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| ------------------ | ------------------------------------------ | -------------- |
| **Anchor**         | –õ–æ–≥–∏—á–µ—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å (form, footer, section) | MUST           |
| **Path**           | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö —É–∑–ª–æ–≤     | MUST           |
| **Target**         | –¶–µ–ª–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç                            | MUST           |
| **Constraints**    | –£—Å–ª–æ–≤–∏—è —Å—É–∂–µ–Ω–∏—è (–∞—Ç—Ä–∏–±—É—Ç—ã, —Ç–µ–∫—Å—Ç, —Ä–æ–ª–∏)    | OPTIONAL       |
| **Fallback rules** | –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏               | MUST           |
| **Meta**           | –í–µ—Ä—Å–∏—è, confidence, —Ñ–ª–∞–≥–∏ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏       | MUST           |

### 5.3 –£–∑–µ–ª DSL

–ö–∞–∂–¥—ã–π —É–∑–µ–ª –æ–±—è–∑–∞–Ω:

- –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `tag`
- –°–æ–¥–µ—Ä–∂–∞—Ç—å 0‚ÄìN —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- –ò–º–µ—Ç—å `score` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç/—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å)
- –ë—ã—Ç—å –≤–∞–ª–∏–¥–∏—Ä—É–µ–º—ã–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

---

## 6. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DSL

### 6.1 –ê–ª–≥–æ—Ä–∏—Ç–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è DSL –¥–æ–ª–∂–Ω–∞:

1. ‚úÖ –ù–∞—á–∏–Ω–∞—Ç—å—Å—è –æ—Ç target-—ç–ª–µ–º–µ–Ω—Ç–∞
2. ‚úÖ –ò—Å–∫–∞—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π anchor –≤–≤–µ—Ä—Ö –ø–æ –¥–µ—Ä–µ–≤—É (‚â§ 10 —É—Ä–æ–≤–Ω–µ–π)
3. ‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å –≤–Ω–∏–∑ (anchor ‚Üí target_parent)
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
5. ‚ùå –ò–∑–±–µ–≥–∞—Ç—å:
   - `nth-*`
   - Layout div
   - Utility-–∫–ª–∞—Å—Å–æ–≤
6. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
   - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã
   - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª–∞—Å—Å—ã
   - SVG-–≥–µ–æ–º–µ—Ç—Ä–∏—é (fingerprint)

### 6.2 –î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è DSL **–Ω–µ –¥–æ–ª–∂–Ω–∞**:

- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å (random)
- ‚ùå –ó–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ö–æ–¥–∞ DOM
- ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ/—Å–µ—Å—Å–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (timestamp, session ID)
- ‚ùå –ó–∞–≤–∏—Å–µ—Ç—å –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è DSL **–¥–æ–ª–∂–Ω–∞**:

- ‚úÖ –î–∞–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–∑–æ–≤–µ
- ‚úÖ –ë—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è (browser, OS)
- ‚úÖ –ë—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–π (same DOM ‚Üí same DSL)

---

## 7. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Resolver (DSL ‚Üí DOM)

### 7.1 –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

Resolver –æ–±—è–∑–∞–Ω:

- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –≤ browser runtime (Chrome, Firefox, Safari)
- ‚úÖ –†–∞–±–æ—Ç–∞—Ç—å –≤ rrweb player (reconstructed DOM)
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞—Ç—å:
  - 0 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
  - 1 —ç–ª–µ–º–µ–Ω—Ç (–Ω–æ—Ä–º–∞)
  - > 1 —ç–ª–µ–º–µ–Ω—Ç (ambiguity ‚Üí fallback)

### 7.2 –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–µ–∑–æ–ª–≤–∞

Resolver –æ–±—è–∑–∞–Ω:

1. **CSS Narrowing**: –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä
2. **JS Filtering**: –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (text, attributes, SVG)
3. **Uniqueness Check**: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
4. **Constraints**: –ø—Ä–∏–º–µ–Ω–∏—Ç—å constraints –ø–æ priority
5. **Fallback**: –ø—Ä–∏–º–µ–Ω–∏—Ç—å fallback-–ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏ –Ω–µ—É—Å–ø–µ—Ö–µ
6. **Result**: –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—ã–π, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 7.3 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è             | –¶–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è | –ú–∞–∫—Å–∏–º—É–º  |
| -------------------- | ------------- | --------- |
| CSS querySelectorAll | ‚â§ 10ms        | 50ms      |
| JS Filtering         | ‚â§ 20ms        | 100ms     |
| Constraints          | ‚â§ 10ms        | 50ms      |
| **Total Resolve**    | **‚â§ 50ms**    | **200ms** |

---

## 8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CSS –∏ XPath

### 8.1 CSS

CSS:

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ **–ø–µ—Ä–≤–∏—á–Ω—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç** (–±—ã—Å—Ç—Ä—ã–π narrowing)
- ‚ùå **–ù–ï** —è–≤–ª—è–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã
- ‚úÖ –î–æ–ª–∂–µ–Ω –±—ã—Ç—å:
  - –í–∞–ª–∏–¥–Ω—ã–º
  - –ò—Å–ø–æ–ª–Ω–∏–º—ã–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–º –∏–∑ DSL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 8.2 XPath (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

XPath –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è:

- ‚úÖ –¢–æ–ª—å–∫–æ –∫–∞–∫ **fallback**
- ‚úÖ –¢–æ–ª—å–∫–æ –∫–∞–∫ **—Ñ–∏–ª—å—Ç—Ä** (–ø–æ—Å–ª–µ CSS narrowing)
- ‚ùå **–ù–ï** –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫ —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏

---

## 9. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å rrweb

### 9.1 –ú–µ—Å—Ç–æ –≤ pipeline

DSL-–∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è **–ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–º, —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–º —Å–≤–æ–π—Å—Ç–≤–æ–º** DOM-—É–∑–ª–∞.

–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ:

- `serializeNode` (–≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

- –ò–Ω—Å–ø–µ–∫—Ü–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Replay-–∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏–π
- –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

### 9.2 –í–∞–∂–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ

```
DSL –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –±–µ–∑ —Å–ª–æ—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.
```

**–ü–æ—á–µ–º—É**:

- DOM –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É —Ä–µ–ª–∏–∑–∞–º–∏
- –†–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí —Ä–∞–∑–Ω—ã–µ DOM-–¥–µ—Ä–µ–≤—å—è (A/B —Ç–µ—Å—Ç—ã)
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è, –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ**: —Å–ª–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Å fuzzy matching –∏ confidence thresholds.

---

## 10. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏—è

DSL –¥–æ–ª–∂–µ–Ω –ø–æ–∑–≤–æ–ª—è—Ç—å:

| –ó–∞–¥–∞—á–∞                             | –ú–µ—Ç–æ–¥                             |
| ---------------------------------- | --------------------------------- |
| –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É    | Hash(DSL) –∫–∞–∫ –∫–ª—é—á –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏    |
| –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ | Levenshtein distance –¥–ª—è DSL      |
| –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ heatmaps                | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∫–ª–∏–∫–æ–≤ –ø–æ hash(DSL)     |
| –í—ã—è–≤–ª–µ–Ω–∏–µ "–º–µ—Ä—Ç–≤—ã—Ö –∑–æ–Ω"            | –≠–ª–µ–º–µ–Ω—Ç—ã —Å 0 –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π       |
| –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–ª–∏–∑–∞–º–∏       | Fuzzy matching —Å confidence > 0.8 |

### –ü—Ä–∏–º–µ—Ä –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

```javascript
// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É
const analytics = events.reduce((acc, event) => {
  const elementId = hash(event.dslIdentity);

  if (!acc[elementId]) {
    acc[elementId] = {
      dsl: event.dslIdentity,
      clicks: 0,
      sessions: new Set(),
    };
  }

  acc[elementId].clicks++;
  acc[elementId].sessions.add(event.sessionId);

  return acc;
}, {});
```

---

## 11. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–µ—Ç—ã

### 11.1 DSL –ù–ï –¥–æ–ª–∂–µ–Ω

| –ó–∞–ø—Ä–µ—Ç                           | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ                         |
| -------------------------------- | ----------------------------------- |
| –¢—Ä–µ–±–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è DOM          | –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º markup      |
| –•—Ä–∞–Ω–∏—Ç—å raw CSS/XPath –∫–∞–∫ –∏—Å—Ç–∏–Ω—É | CSS ‚Äî —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –Ω–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å    |
| –ó–∞–≤–∏—Å–µ—Ç—å –æ—Ç nth-child            | –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ siblings |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å dynamic id          | ID –≤–∏–¥–∞ `elem-12345` –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è   |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å inline styles       | –ú–µ–Ω—è—é—Ç—Å—è —á–∞—Å—Ç–æ                      |
| –ù–∞—Ä—É—à–∞—Ç—å privacy                 | PII –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è                   |

### 11.2 –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏

- ‚ùå –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (x, y)
- ‚ùå Layout-–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (width, height)
- ‚ùå Framework-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ ID (`data-reactid`)
- ‚ùå Random/generated –∫–ª–∞—Å—Å—ã (`css-1a2b3c`)
- ‚ùå Z-index, opacity –∫–∞–∫ –∫—Ä–∏—Ç–µ—Ä–∏–∏
- ‚ùå Viewport-–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
- ‚ùå –ü–æ—Ä—è–¥–æ–∫ –≤ DOM (nth-child)

---

## 12. –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

–†–µ—à–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º, –µ—Å–ª–∏:

| –ú–µ—Ç—Ä–∏–∫–∞                         | Baseline | Target            | Excellent |
| ------------------------------- | -------- | ----------------- | --------- |
| –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å DSL –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ | 80%      | **95%**           | 98%       |
| –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–µ–∑–æ–ª–≤–∞ –≤ replay     | 90%      | **99%**           | 99.9%     |
| –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ layout changes   | 80%      | **100%**          | 100%      |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DSL (—Å–ª–æ–∂–Ω–æ—Å—Ç—å)       | O(n)     | **O(depth)**      | O(depth)  |
| –†–µ–∑–æ–ª–≤ DSL (—Å–ª–æ–∂–Ω–æ—Å—Ç—å)          | O(n¬≤)    | **O(candidates)** | O(log n)  |
| –†–∞–∑–º–µ—Ä DSL (JSON)               | 5KB      | **2KB**           | 1KB       |
| –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏                 | 20ms     | **5ms**           | 1ms       |
| –í—Ä–µ–º—è —Ä–µ–∑–æ–ª–≤–∞                   | 100ms    | **50ms**          | 10ms      |

---

## 13. Deliverables (–í—ã—Ö–æ–¥—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è)

–†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Ä–∞–±–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:

| #   | Deliverable           | –§–æ—Ä–º–∞—Ç              | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| --- | --------------------- | ------------------- | --------- |
| 1   | –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è DSL v1.0 | Markdown            | MUST      |
| 2   | AST-—Ñ–æ—Ä–º–∞—Ç            | TypeScript types    | MUST      |
| 3   | –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä DSL         | TypeScript library  | MUST      |
| 4   | Resolver DSL ‚Üí DOM    | TypeScript library  | MUST      |
| 5   | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å rrweb    | Patch/plugin        | MUST      |
| 6   | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è          | Markdown + examples | MUST      |
| 7   | –ù–∞–±–æ—Ä edge-–∫–µ–π—Å–æ–≤     | Test suite          | SHOULD    |
| 8   | Benchmark suite       | Performance tests   | SHOULD    |

---

## 14. –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏–∏

| –†–∏—Å–∫                         | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ   | –ú–∏—Ç–∏–≥–∞—Ü–∏—è                                    |
| ---------------------------- | ----------- | --------- | -------------------------------------------- |
| DSL –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω –º–µ–∂–¥—É –±–∏–ª–¥–∞–º–∏ | –°—Ä–µ–¥–Ω—è—è     | –í—ã—Å–æ–∫–æ–µ   | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å semantic –ø—Ä–∏–∑–Ω–∞–∫–∏, –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | –ù–∏–∑–∫–∞—è      | –°—Ä–µ–¥–Ω–µ–µ   | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ           |
| –†–∞–∑–º–µ—Ä DSL —Å–ª–∏—à–∫–æ–º –≤–µ–ª–∏–∫     | –°—Ä–µ–¥–Ω—è—è     | –°—Ä–µ–¥–Ω–µ–µ   | –ö–æ–º–ø—Ä–µ—Å—Å–∏—è, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è path                 |
| Ambiguity –ø—Ä–∏ —Ä–µ–∑–æ–ª–≤–µ        | –í—ã—Å–æ–∫–∞—è     | –°—Ä–µ–¥–Ω–µ–µ   | Constraints, fallback-–º–µ—Ö–∞–Ω–∏–∑–º—ã              |
| Privacy –Ω–∞—Ä—É—à–µ–Ω–∏—è            | –ù–∏–∑–∫–∞—è      | –ö—Ä–∏—Ç–∏—á–Ω–æ–µ | –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è PII, –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞          |
| –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å rrweb      | –ù–∏–∑–∫–∞—è      | –í—ã—Å–æ–∫–æ–µ   | –¢–µ—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ rrweb API   |

---

## 15. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Phase 1: Core (MVP)

- ‚úÖ Anchor Strategy
- ‚úÖ Path Construction
- ‚úÖ Basic Resolver
- ‚úÖ JSON Serialization

### Phase 2: Stability

- ‚úÖ SVG Fingerprinting
- ‚úÖ Semantic Filtering
- ‚úÖ Text Normalization
- ‚úÖ Constraints System

### Phase 3: Integration

- rrweb recorder integration
- rrweb player integration
- Analytics pipeline

### Phase 4: Optimization

- Performance optimization
- Size optimization
- Edge cases handling

---

## 16. Success Criteria (Acceptance)

–ü—Ä–æ–µ–∫—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:

### Must Have

- [x] –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞
- [ ] –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä DSL —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Resolver —Ä–∞–±–æ—Ç–∞–µ—Ç —Å accuracy ‚â• 95%
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å rrweb —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Unit tests coverage ‚â• 80%

### Should Have

- [ ] Performance benchmarks
- [ ] Edge cases covered
- [ ] Documentation complete
- [ ] Examples provided

### Nice to Have

- [ ] Visual debugging tools
- [ ] Browser extension –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DSL
- [ ] Analytics dashboard

---

## 17. –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –≤–ª–∞–¥–µ–ª—å—Ü—ã

**–ê–≤—Ç–æ—Ä —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: Artem  
**–†–æ–ª—å**: Backend & Frontend Developer  
**Expertise**: TypeScript, rrweb, browser automation, WebDriver

**Stakeholders**:

- rrweb community
- Analytics teams
- QA automation teams

---

## Changelog

### 2025-01-15

- –ù–∞—á–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã scope, deliverables, metrics
- –£—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞**: –£–¢–í–ï–†–ñ–î–ï–ù–û  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°–ª–µ–¥—É—é—â–∏–π review**: –ü–æ—Å–ª–µ Phase 1 implementation
